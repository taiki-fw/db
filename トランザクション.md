# トランザクションとは

- セットで実行されるべき、1 つ以上の更新処理のあつまりのこと
- 対象となる SQL 文は`(INSERT/UPDATE/DELETE)`など

## トランザクションの一連の流れ

### BEGIN TRANSACTION

トランザクションの開始文

```sql
BEGIN TRANSACTION;
```

### COMMIT

トランザクションに含まれていた処理の変更を反映させ、終了する文

```sql
COMMIT;
```

**注意：一度コミットしたら、もうトランザクション開始前の状態には戻れない**

### ROLLBACK

トランザクションに含まれていた処理の変更をすべて破棄し、終了する文。<br>
トランザクション開始前に状態が戻る。

```sql
ROLLBACK;
```

> トランザクションの終了は、`COMMIT` または `ROLLBACK`

## トランザクションの性質 ACID 特性

### 原子性(Atomicity)

トランザクションが終了した際に、そこに含まれていた更新処理は、<br>
すべて実行される(COMMIT)か、<br>
すべて実行されない状態(ROLLBACK)で終わる<br>
ことを証明する性質。

### 一貫性(Consistency)

トランザクションに含まれる処理は、<br>
データベースにあらかじめ設定された制約(主キー、NOT NULL)を満たす。

### 独立性(Isolation)

トランザクション同士がお互いに干渉を受けないことを保証する性質

### 永続性(Durability)

トランザクションが終了したら、その時点でのデータの状態が保存されることを保証する性質<br>
※方法としては「ログ」などがある。
